<Application xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:models="clr-namespace:Spravy.Ui.Models"
             xmlns:interfaces="clr-namespace:Spravy.Ui.Interfaces"
             xmlns:handlers="clr-namespace:Spravy.Ui.Handlers"
             xmlns:converters="clr-namespace:Spravy.Ui.Converters"
             xmlns:themes="clr-namespace:Material.Styles.Themes;assembly=Material.Styles"
             xmlns:avalonia="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
             xmlns:dialogHostAvalonia="clr-namespace:DialogHostAvalonia;assembly=DialogHost.Avalonia"
             xmlns:controls="clr-namespace:Material.Styles.Controls;assembly=Material.Styles"
             xmlns:viewModels="clr-namespace:Spravy.Ui.ViewModels"
             x:Class="Spravy.Ui.App"
             RequestedThemeVariant="Dark">
    <Application.Styles>
        <FluentTheme DensityStyle="Compact" />
        <themes:MaterialTheme BaseTheme="Dark" PrimaryColor="Teal" SecondaryColor="DeepOrange" />
        <avalonia:MaterialIconStyles />
        <dialogHostAvalonia:DialogHostStyles />
        <StyleInclude Source="avares://Spravy.Ui/Styles/Theme.axaml" />

        <Style Selector="ListBox.ItemsDragAndDrop">
            <Style.Resources>
                <handlers:ItemsListBoxDropHandlerToDoItemNotify x:Key="ItemsListBoxDropHandler" />
            </Style.Resources>

            <Setter Property="(Interaction.Behaviors)">
                <BehaviorCollectionTemplate>
                    <BehaviorCollection>
                        <ContextDropBehavior Handler="{StaticResource ItemsListBoxDropHandler}" />
                    </BehaviorCollection>
                </BehaviorCollectionTemplate>
            </Setter>
        </Style>

        <Style Selector="ListBox.ItemsDragAndDrop ListBoxItem">
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="(Interaction.Behaviors)">
                <BehaviorCollectionTemplate>
                    <BehaviorCollection>
                        <ContextDragBehavior HorizontalDragThreshold="3" VerticalDragThreshold="3" />
                    </BehaviorCollection>
                </BehaviorCollectionTemplate>
            </Setter>
        </Style>

        <Style Selector="Button">
            <Setter Property="Margin" Value="5" />
        </Style>
    </Application.Styles>

    <Application.DataTemplates>
        <DataTemplate x:DataType="models:TimerItemToDoItemFavoriteNotify">
            <StackPanel>
                <CheckBox IsChecked="{Binding IsFavorite}" />
                <TextBlock Text="{Binding DueDateTime, StringFormat=\{0:yyyy.MM.dd HH:mm zzz\}}" />
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:DataType="models:ToDoItemCommand">
            <Button Command="{Binding Command}">
                <avalonia:MaterialIcon Kind="{Binding Icon}" />
            </Button>
        </DataTemplate>

        <TreeDataTemplate DataType="models:ToDoSelectorItemNotify" ItemsSource="{Binding Children}">
            <TextBlock Text="{Binding Name}" />
        </TreeDataTemplate>

        <DataTemplate DataType="models:ToDoItemParentNotify">
            <Button Margin="3"
                    Command="{Binding $parent[interfaces:IPathView].ChangeToDoItemByPathCommand}"
                    CommandParameter="{Binding}">
                <TextBlock Text="{Binding Name}" />
            </Button>
        </DataTemplate>

        <DataTemplate DataType="models:RootItem">
            <Button Margin="3"
                    Command="{Binding $parent[interfaces:IPathView].ToRootItemCommand}">
                <avalonia:MaterialIcon Kind="Home" />
            </Button>
        </DataTemplate>

        <DataTemplate DataType="models:ToDoItemNotify">
            <TextBlock Text="{Binding Name}" />
        </DataTemplate>

        <!--#region ToDoSubItemNotify-->
        <DataTemplate DataType="models:ToDoSubItemValueNotify">
            <controls:Card ToolTip.Tip="{Binding Description, Converter={StaticResource EmptyStringToNullConverter}}"
                           IsVisible="{Binding IsVisible}"
                           Margin="3">
                <Grid ColumnDefinitions="*,Auto"
                      RowDefinitions="Auto,*"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      Margin="5">
                    <Grid Grid.ColumnSpan="2" ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                        <Rectangle Width="15"
                                   Margin="0,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="1" Text="Value" Classes="Body2" />
                        <Rectangle Grid.Column="2"
                                   Margin="3,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="3" Text="{Binding Status}" Classes="Body2" />
                        <Rectangle Grid.Column="4"
                                   Width="15"
                                   Margin="3,0,0,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                    </Grid>

                    <StackPanel Grid.Row="1">
                        <TextBlock Text="{Binding Name}"
                                   Classes="Headline6"
                                   TextWrapping="Wrap" />

                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Rectangle Fill="Green" Height="6" Width="{Binding CompletedPercentage}" />
                                <Rectangle Fill="Yellow" Height="6" Width="{Binding SkippedPercentage}" />
                                <Rectangle Fill="Red" Height="6" Width="{Binding FailedPercentage}" />
                            </StackPanel>

                            <TextBlock
                                Text="{Binding LastCompleted, StringFormat=LastCompleted: \{0:yyyy\\.MM\\.dd hh\\:mm\\:ss\}}"
                                IsVisible="{Binding  LastCompleted, Converter={StaticResource NullToBooleanConverter}}" />
                        </StackPanel>

                        <Grid ColumnDefinitions="Auto,Auto,Auto,*" RowDefinitions="Auto,Auto,Auto">
                            <Button Grid.ColumnSpan="3"
                                    Width="320"
                                    IsVisible="{Binding Active, Converter={StaticResource NullToBooleanConverter}}"
                                    CommandParameter="{Binding Active}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToActiveDoItemCommand}">
                                <WrapPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Active.Name}"
                                               TextWrapping="Wrap"
                                               VerticalAlignment="Center" />
                                    <avalonia:MaterialIcon Margin="5,0,0,0" Kind="ArrowRight" />
                                </WrapPanel>
                            </Button>

                            <Button Grid.Row="1" Classes="with-text" CommandParameter="{Binding}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeOrderIndexCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ReorderHorizontal" />
                                    <TextBlock Text="Reorder" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="2" Classes="with-text" CommandParameter="{Binding}"
                                    Command="{Binding $parent[interfaces:ICompleteSubToDoItemCommand].CompleteSubToDoItemCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Check" />
                                    <TextBlock Text="Complete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="1"
                                    Classes="with-text Accent"
                                    Command="{Binding $parent[interfaces:IToDoItemView].DeleteSubToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Delete" />
                                    <TextBlock Text="Delete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="2"
                                    Classes="with-text"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ArrowRight" />
                                    <TextBlock Text="Open" />
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>

                    <Panel Grid.Row="1"
                           Grid.Column="1"
                           VerticalAlignment="Top"
                           HorizontalAlignment="Right">
                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].RemoveSubToDoItemFromFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite}">
                            <avalonia:MaterialIcon Kind="Star" />
                        </Button>

                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].AddSubToDoItemToFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite, Converter={StaticResource ReverseBooleanValueConverter}}">
                            <avalonia:MaterialIcon Kind="StarOutline" />
                        </Button>
                    </Panel>
                </Grid>
            </controls:Card>
        </DataTemplate>

        <DataTemplate DataType="models:ToDoSubItemGroupNotify">
            <controls:Card ToolTip.Tip="{Binding Description, Converter={StaticResource EmptyStringToNullConverter}}"
                           IsVisible="{Binding IsVisible}"
                           Margin="3">
                <Grid ColumnDefinitions="*,Auto"
                      RowDefinitions="Auto,*"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      Margin="5">
                    <Grid Grid.ColumnSpan="2" ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                        <Rectangle Width="15"
                                   Margin="0,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="1" Text="Group" Classes="Body2" />
                        <Rectangle Grid.Column="2"
                                   Margin="3,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="3" Text="{Binding Status}" Classes="Body2" />
                        <Rectangle Grid.Column="4"
                                   Width="15"
                                   Margin="3,0,0,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                    </Grid>

                    <StackPanel Grid.Row="1">
                        <TextBlock Text="{Binding Name}"
                                   Classes="Headline6"
                                   TextWrapping="Wrap" />

                        <Grid ColumnDefinitions="Auto,Auto,Auto,*" RowDefinitions="Auto,Auto">
                            <Button Grid.ColumnSpan="3"
                                    Width="320"
                                    IsVisible="{Binding Active, Converter={StaticResource NullToBooleanConverter}}"
                                    CommandParameter="{Binding Active}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToActiveDoItemCommand}">
                                <WrapPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Active.Name}"
                                               TextWrapping="Wrap"
                                               VerticalAlignment="Center" />
                                    <avalonia:MaterialIcon Margin="5,0,0,0" Kind="ArrowRight" />
                                </WrapPanel>
                            </Button>

                            <Button Grid.Row="1" Classes="with-text" CommandParameter="{Binding}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeOrderIndexCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ReorderHorizontal" />
                                    <TextBlock Text="Reorder" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="1"
                                    Classes="with-text Accent"
                                    Command="{Binding $parent[interfaces:IToDoItemView].DeleteSubToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Delete" />
                                    <TextBlock Text="Delete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="2"
                                    Classes="with-text"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ArrowRight" />
                                    <TextBlock Text="Open" />
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>

                    <Panel Grid.Row="1" Grid.Column="1" VerticalAlignment="Top"
                           HorizontalAlignment="Right">
                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].RemoveSubToDoItemFromFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite}">
                            <avalonia:MaterialIcon Kind="Star" />
                        </Button>

                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].AddSubToDoItemToFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite, Converter={StaticResource ReverseBooleanValueConverter}}">
                            <avalonia:MaterialIcon Kind="StarOutline" />
                        </Button>
                    </Panel>
                </Grid>
            </controls:Card>
        </DataTemplate>

        <DataTemplate DataType="models:ToDoSubItemPlannedNotify">
            <controls:Card ToolTip.Tip="{Binding Description, Converter={StaticResource EmptyStringToNullConverter}}"
                           IsVisible="{Binding IsVisible}"
                           Margin="3">
                <Grid ColumnDefinitions="*,Auto"
                      RowDefinitions="Auto,*"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      Margin="5">
                    <Grid Grid.ColumnSpan="2" ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                        <Rectangle Width="15"
                                   Margin="0,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="1" Text="Planned" Classes="Body2" />
                        <Rectangle Grid.Column="2"
                                   Margin="3,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="3" Text="{Binding Status}" Classes="Body2" />
                        <Rectangle Grid.Column="4"
                                   Width="15"
                                   Margin="3,0,0,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                    </Grid>

                    <StackPanel Grid.Row="1">
                        <TextBlock Text="{Binding Name}"
                                   Classes="Headline6"
                                   TextWrapping="Wrap" />

                        <TextBlock Text="{Binding DueDate, StringFormat=DueDate: \{0:yyyy.MM.dd\}}" />

                        <TextBlock
                            Text="{Binding LastCompleted, StringFormat=LastCompleted: \{0:yyyy\\.MM\\.dd hh\\:mm\\:ss\}}"
                            IsVisible="{Binding  LastCompleted, Converter={StaticResource NullToBooleanConverter}}" />

                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Rectangle Fill="Green" Height="6" Width="{Binding CompletedPercentage}" />
                                <Rectangle Fill="Yellow" Height="6" Width="{Binding SkippedPercentage}" />
                                <Rectangle Fill="Red" Height="6" Width="{Binding FailedPercentage}" />
                            </StackPanel>
                        </StackPanel>

                        <Grid ColumnDefinitions="Auto,Auto,Auto,*" RowDefinitions="Auto,Auto,Auto">
                            <Button Grid.ColumnSpan="3"
                                    Width="320"
                                    IsVisible="{Binding Active, Converter={StaticResource NullToBooleanConverter}}"
                                    CommandParameter="{Binding Active}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToActiveDoItemCommand}">
                                <WrapPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Active.Name}"
                                               TextWrapping="Wrap"
                                               VerticalAlignment="Center" />
                                    <avalonia:MaterialIcon Margin="5,0,0,0" Kind="ArrowRight" />
                                </WrapPanel>
                            </Button>

                            <Button Grid.Row="1" Classes="with-text" CommandParameter="{Binding}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeOrderIndexCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ReorderHorizontal" />
                                    <TextBlock Text="Reorder" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="2"
                                    Classes="with-text"
                                    Command="{Binding $parent[interfaces:ICompleteSubToDoItemCommand].CompleteSubToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Check" />
                                    <TextBlock Text="Complete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="1"
                                    Classes="with-text Accent"
                                    Command="{Binding $parent[interfaces:IToDoItemView].DeleteSubToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Delete" />
                                    <TextBlock Text="Delete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="2"
                                    Classes="with-text"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ArrowRight" />
                                    <TextBlock Text="Open" />
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>

                    <Panel Grid.Row="1" Grid.Column="1" VerticalAlignment="Top" HorizontalAlignment="Right">
                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].RemoveSubToDoItemFromFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite}">
                            <avalonia:MaterialIcon Kind="Star" />
                        </Button>

                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].AddSubToDoItemToFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite, Converter={StaticResource ReverseBooleanValueConverter}}">
                            <avalonia:MaterialIcon Kind="StarOutline" />
                        </Button>
                    </Panel>
                </Grid>
            </controls:Card>
        </DataTemplate>

        <DataTemplate DataType="models:ToDoSubItemPeriodicityNotify">
            <controls:Card ToolTip.Tip="{Binding Description, Converter={StaticResource EmptyStringToNullConverter}}"
                           IsVisible="{Binding IsVisible}"
                           Margin="3">
                <Grid ColumnDefinitions="*,Auto"
                      RowDefinitions="Auto,*"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      Margin="5">
                    <Grid Grid.ColumnSpan="2" ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                        <Rectangle Width="15"
                                   Margin="0,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="1" Text="Periodicity" Classes="Body2" />
                        <Rectangle Grid.Column="2"
                                   Margin="3,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="3" Text="{Binding Status}" Classes="Body2" />
                        <Rectangle Grid.Column="4"
                                   Width="15"
                                   Margin="3,0,0,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                    </Grid>

                    <StackPanel Grid.Row="1">
                        <TextBlock Text="{Binding Name}"
                                   Classes="Headline6"
                                   TextWrapping="Wrap" />

                        <TextBlock Text="{Binding DueDate, StringFormat=DueDate: \{0:yyyy.MM.dd\}}" />

                        <TextBlock
                            Text="{Binding LastCompleted, StringFormat=LastCompleted: \{0:yyyy\\.MM\\.dd hh\\:mm\\:ss\}}"
                            IsVisible="{Binding  LastCompleted, Converter={StaticResource NullToBooleanConverter}}" />

                        <StackPanel Orientation="Horizontal">
                            <Rectangle Fill="Green" Height="6" Width="{Binding CompletedPercentage}" />
                            <Rectangle Fill="Yellow" Height="6" Width="{Binding SkippedPercentage}" />
                            <Rectangle Fill="Red" Height="6" Width="{Binding FailedPercentage}" />
                        </StackPanel>

                        <Grid ColumnDefinitions="Auto,Auto,Auto,*" RowDefinitions="Auto,Auto,Auto">
                            <Button Grid.ColumnSpan="3" 
                                    Width="320"
                                    CommandParameter="{Binding Active}"
                                    IsVisible="{Binding Active, Converter={StaticResource NullToBooleanConverter}}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToActiveDoItemCommand}">
                                <WrapPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Active.Name}"
                                               TextWrapping="Wrap"
                                               VerticalAlignment="Center" />
                                    <avalonia:MaterialIcon Margin="5,0,0,0" Kind="ArrowRight" />
                                </WrapPanel>
                            </Button>

                            <Button Grid.Row="1" Classes="with-text" CommandParameter="{Binding}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeOrderIndexCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ReorderHorizontal" />
                                    <TextBlock Text="Reorder" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="2"
                                    Classes="with-text"
                                    Command="{Binding $parent[interfaces:ICompleteSubToDoItemCommand].CompleteSubToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Check" />
                                    <TextBlock Text="Complete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="1"
                                    Classes="with-text Accent"
                                    Command="{Binding $parent[interfaces:IToDoItemView].DeleteSubToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Delete" />
                                    <TextBlock Text="Delete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="2"
                                    Classes="with-text"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ArrowRight" />
                                    <TextBlock Text="Open" />
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>

                    <Panel Grid.Row="1" Grid.Column="1" VerticalAlignment="Top" HorizontalAlignment="Right">
                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].RemoveSubToDoItemFromFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite}">
                            <avalonia:MaterialIcon Kind="Star" />
                        </Button>

                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].AddSubToDoItemToFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite, Converter={StaticResource ReverseBooleanValueConverter}}">
                            <avalonia:MaterialIcon Kind="StarOutline" />
                        </Button>
                    </Panel>
                </Grid>
            </controls:Card>
        </DataTemplate>

        <DataTemplate DataType="models:ToDoSubItemPeriodicityOffsetNotify">
            <controls:Card ToolTip.Tip="{Binding Description, Converter={StaticResource EmptyStringToNullConverter}}"
                           IsVisible="{Binding IsVisible}"
                           Margin="3">
                <Grid ColumnDefinitions="*,Auto"
                      RowDefinitions="Auto,*"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      Margin="5">
                    <Grid Grid.ColumnSpan="2" ColumnDefinitions="Auto,Auto,*,Auto,Auto">
                        <Rectangle Width="15"
                                   Margin="0,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="1" Text="PeriodicityOffset" Classes="Body2" />
                        <Rectangle Grid.Column="2"
                                   Margin="3,0,3,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                        <TextBlock Grid.Column="3" Text="{Binding Status}" Classes="Body2" />
                        <Rectangle Grid.Column="4"
                                   Width="15"
                                   Margin="3,0,0,0"
                                   Height="2"
                                   Fill="{Binding Status, Converter={StaticResource ToDoItemStatusToBrushValueConverter}}" />
                    </Grid>

                    <StackPanel Grid.Row="1">
                        <TextBlock Text="{Binding Name}"
                                   Classes="Headline6"
                                   TextWrapping="Wrap" />

                        <TextBlock Text="{Binding DueDate, StringFormat=DueDate: \{0:yyyy.MM.dd\}}" />

                        <TextBlock
                            Text="{Binding LastCompleted, StringFormat=LastCompleted: \{0:yyyy\\.MM\\.dd hh\\:mm\\:ss\}}"
                            IsVisible="{Binding  LastCompleted, Converter={StaticResource NullToBooleanConverter}}" />

                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Rectangle Fill="Green" Height="6" Width="{Binding CompletedPercentage}" />
                                <Rectangle Fill="Yellow" Height="6" Width="{Binding SkippedPercentage}" />
                                <Rectangle Fill="Red" Height="6" Width="{Binding FailedPercentage}" />
                            </StackPanel>
                        </StackPanel>

                        <Grid ColumnDefinitions="Auto,Auto,Auto,*" RowDefinitions="Auto,Auto,Auto">
                            <Button Grid.ColumnSpan="3"
                                    Width="320"
                                    IsVisible="{Binding Active, Converter={StaticResource NullToBooleanConverter}}"
                                    CommandParameter="{Binding Active}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToActiveDoItemCommand}">
                                <WrapPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Active.Name}"
                                               TextWrapping="Wrap"
                                               VerticalAlignment="Center" />
                                    <avalonia:MaterialIcon Margin="5,0,0,0" Kind="ArrowRight" />
                                </WrapPanel>
                            </Button>

                            <Button Grid.Row="1" Classes="with-text" CommandParameter="{Binding}"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeOrderIndexCommand}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ReorderHorizontal" />
                                    <TextBlock Text="Reorder" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="2"
                                    Classes="with-text"
                                    Command="{Binding $parent[interfaces:ICompleteSubToDoItemCommand].CompleteSubToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Check" />
                                    <TextBlock Text="Complete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="1"
                                    Classes="with-text Accent"
                                    Command="{Binding $parent[interfaces:IToDoItemView].DeleteSubToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="Delete" />
                                    <TextBlock Text="Delete" />
                                </StackPanel>
                            </Button>

                            <Button Grid.Row="1"
                                    Grid.Column="2"
                                    Classes="with-text"
                                    Command="{Binding $parent[interfaces:IToDoItemView].ChangeToDoItemCommand}"
                                    CommandParameter="{Binding}">
                                <StackPanel Orientation="Horizontal">
                                    <avalonia:MaterialIcon Kind="ArrowRight" />
                                    <TextBlock Text="Open" />
                                </StackPanel>
                            </Button>
                        </Grid>
                    </StackPanel>

                    <Panel Grid.Row="1" Grid.Column="1" VerticalAlignment="Top" HorizontalAlignment="Right">
                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].RemoveSubToDoItemFromFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite}">
                            <avalonia:MaterialIcon Kind="Star" />
                        </Button>

                        <Button
                            Command="{Binding $parent[interfaces:IChangeFavoriteToDoItemCommand].AddSubToDoItemToFavoriteCommand}"
                            CommandParameter="{Binding}"
                            IsVisible="{Binding IsFavorite, Converter={StaticResource ReverseBooleanValueConverter}}">
                            <avalonia:MaterialIcon Kind="StarOutline" />
                        </Button>
                    </Panel>
                </Grid>
            </controls:Card>
        </DataTemplate>
        <!--#endregion ToDoSubItemNotify-->

        <DataTemplate DataType="viewModels:AnnuallyPeriodicityViewModel">
            <ContentControl Content="{Binding DayOfYearSelector}" />
        </DataTemplate>

        <DataTemplate DataType="viewModels:DailyPeriodicityViewModel" />

        <DataTemplate DataType="viewModels:MonthlyPeriodicityViewModel">
            <ContentControl Content="{Binding DayOfMonthSelector}" />
        </DataTemplate>

        <DataTemplate DataType="viewModels:WeeklyPeriodicityViewModel">
            <ContentControl Content="{Binding DayOfWeekSelector}" />
        </DataTemplate>
    </Application.DataTemplates>

    <Application.Resources>
        <converters:ObjectToVisibleValueConverter x:Key="ObjectToVisibleValueConverter" />
        <converters:ToDoItemStatusToBrushValueConverter x:Key="ToDoItemStatusToBrushValueConverter" />
        <converters:ReverseBooleanValueConverter x:Key="ReverseBooleanValueConverter" />
        <converters:EmptyStringToNullConverter x:Key="EmptyStringToNullConverter" />
        <converters:NullToBooleanConverter x:Key="NullToBooleanConverter" />
        <converters:UInt32ToIsVisibleConverter x:Key="UInt32ToIsVisibleConverter" />
        <converters:Int32ToIsVisibleConverter x:Key="Int32ToIsVisibleConverter" />
        <converters:CompleteStatusToBrushConverter x:Key="CompleteStatusToBrushConverter" />
    </Application.Resources>
</Application>